
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¯ÙØªØ± Ø§Ù„Ø¯ÙØ¹Ø§Øª</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {font-family:"Cairo",sans-serif;background:linear-gradient(135deg,#0f172a,#1e293b);color:#f1f5f9;padding:20px;text-align:center;}
    h1{margin-bottom:10px;color:#38bdf8;}
    img.logo{width:100px;margin-bottom:15px;}
    .controls{margin:15px 0;}
    button{margin:5px;padding:10px 15px;border:none;background:#2563eb;color:white;border-radius:8px;cursor:pointer;font-size:14px;transition:0.2s;}
    button:hover{background:#1d4ed8;}
    input[type="text"]{padding:8px;border-radius:6px;border:1px solid #334155;margin-bottom:10px;width:50%;text-align:center;}
    table{width:100%;border-collapse:collapse;background:#1e293b;margin-top:10px;border-radius:10px;overflow:hidden;}
    th,td{border:1px solid #334155;padding:10px;text-align:center;}
    th{background:#0f172a;color:#38bdf8;}
    tr:nth-child(even){background:#273449;}
    td[contenteditable="true"]{outline:none;}
    footer{margin-top:20px;font-size:14px;color:#94a3b8;}
    .highlight{color:#22c55e;font-weight:bold;}
  </style>
</head>
<body>
  <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬" class="logo">
  <h1>ğŸ“˜ Ø¯ÙØªØ± Ø§Ù„Ø¯ÙØ¹Ø§Øª</h1>

  <input type="text" id="searchBox" placeholder="ğŸ” Ø§Ø¨Ø­Ø«..." onkeyup="searchTable()">

  <div class="controls">
    <button onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© ØµÙ</button>
    <button onclick="deleteSelected()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
    <button onclick="saveData()">ğŸ’¾ Ø­ÙØ¸</button>
    <button onclick="clearAll()">ğŸ§¹ ØªÙØ±ÙŠØº</button>
    <button onclick="saveAsImage()">ğŸ“· Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©</button>
    <button onclick="exportToCSV()">ğŸ“‘ ØªØµØ¯ÙŠØ± Excel</button>
    <button onclick="printPDF()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© PDF</button>
  </div>

  <table id="table">
    <thead>
      <tr>
        <th><input type="checkbox" onclick="toggleAll(this)"></th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ù…Ø¹Ù‡Ø¯ / Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th>
        <th>Ø§Ù„ÙˆØµÙ</th>
        <th>Ø§Ù„Ù†ÙˆØ¹</th>
        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="sum" class="highlight">0</span></p>
  <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: <span id="count">0</span> | Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø®Ù„: <span id="incomeCount">0</span> | Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ±ÙˆÙ: <span id="expenseCount">0</span></p>
  <p>Ø¢Ø®Ø± Ø­ÙØ¸: <span id="lastSaved">Ù„Ù… ÙŠØªÙ… Ø¨Ø¹Ø¯</span></p>

  <footer>
    <p>ØªØ·ÙˆÙŠØ±: <b>Ù…Ø­Ù…Ø¯ Ø´Ø§Ø´Ùˆ</b></p>
    <p>Ø¥Ù‡Ø¯Ø§Ø¡ Ø¥Ù„Ù‰ Ø£Ø³ØªØ§Ø°ÙŠ Ø§Ù„Ø¹Ø²ÙŠØ²: <b>Ø¯. Ù…Ø­Ù…Ø¯ ØµØ¨Ø§Øº</b></p>
  </footer>

  <script>
    const tbody=document.getElementById("tbody");
    const sumEl=document.getElementById("sum");
    const lastSavedEl=document.getElementById("lastSaved");
    const STORAGE_KEY="payments_data";

    function addRow(data={}) {
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><input type="checkbox" class="row-check"></td>
        <td contenteditable="true">${data.date||new Date().toISOString().slice(0,10)}</td>
        <td contenteditable="true">${data.school||""}</td>
        <td contenteditable="true">${data.desc||""}</td>
        <td contenteditable="true">${data.type||"Ø¯Ø®Ù„"}</td>
        <td contenteditable="true">${data.amount||0}</td>
        <td contenteditable="true">${data.status||"Ù…Ø¹Ù„Ù‚"}</td>
        <td contenteditable="true">${data.note||""}</td>`;
      tbody.appendChild(tr);
      updateSum();updateSummary();
    }

    function deleteSelected(){document.querySelectorAll(".row-check:checked").forEach(ch=>ch.closest("tr").remove());updateSum();updateSummary();saveData();}
    function toggleAll(master){document.querySelectorAll(".row-check").forEach(ch=>ch.checked=master.checked);}
    function updateSum(){let total=0;tbody.querySelectorAll("tr").forEach(tr=>{const amount=parseFloat(tr.cells[5].textContent)||0;const type=tr.cells[4].textContent.trim();total+=(type==="Ù…ØµØ±ÙˆÙ")?-amount:amount;});sumEl.textContent=total.toFixed(2);}
    function updateSummary(){let rows=tbody.querySelectorAll("tr");document.getElementById("count").textContent=rows.length;let income=0,expense=0;rows.forEach(tr=>{let type=tr.cells[4].textContent.trim();if(type==="Ø¯Ø®Ù„")income++;if(type==="Ù…ØµØ±ÙˆÙ")expense++;});document.getElementById("incomeCount").textContent=income;document.getElementById("expenseCount").textContent=expense;}
    function saveData(){const rows=[...tbody.querySelectorAll("tr")].map(tr=>({date:tr.cells[1].textContent,school:tr.cells[2].textContent,desc:tr.cells[3].textContent,type:tr.cells[4].textContent,amount:tr.cells[5].textContent,status:tr.cells[6].textContent,note:tr.cells[7].textContent}));localStorage.setItem(STORAGE_KEY,JSON.stringify(rows));lastSavedEl.textContent=new Date().toLocaleString();}
    function loadData(){const raw=localStorage.getItem(STORAGE_KEY);if(raw){JSON.parse(raw).forEach(r=>addRow(r));}else{addRow();}}
    function clearAll(){if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ±ÙŠØº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")){tbody.innerHTML="";updateSum();updateSummary();localStorage.removeItem(STORAGE_KEY);lastSavedEl.textContent="ØªÙ… Ø§Ù„ØªÙØ±ÙŠØº";}}
    function saveAsImage(){html2canvas(document.body).then(canvas=>{const link=document.createElement("a");link.download="Ø¯ÙØªØ±_Ø§Ù„Ø¯ÙØ¹Ø§Øª.png";link.href=canvas.toDataURL();link.click();});}
    function exportToCSV(){let rows=[["Ø§Ù„ØªØ§Ø±ÙŠØ®","Ø§Ù„Ù…Ø¹Ù‡Ø¯/Ø§Ù„Ù…Ø¯Ø±Ø³Ø©","Ø§Ù„ÙˆØµÙ","Ø§Ù„Ù†ÙˆØ¹","Ø§Ù„Ù…Ø¨Ù„Øº","Ø§Ù„Ø­Ø§Ù„Ø©","Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]];tbody.querySelectorAll("tr").forEach(tr=>{let row=[];for(let i=1;i<tr.cells.length;i++){row.push(tr.cells[i].textContent);}rows.push(row);});let csvContent="data:text/csv;charset=utf-8,"+rows.map(e=>e.join(",")).join("\n");const link=document.createElement("a");link.setAttribute("href",encodeURI(csvContent));link.setAttribute("download","Ø¯ÙØªØ±_Ø§Ù„Ø¯ÙØ¹Ø§Øª.csv");link.click();}
    function printPDF(){window.print();}
    function searchTable(){let filter=document.getElementById("searchBox").value.toLowerCase();tbody.querySelectorAll("tr").forEach(tr=>{let text=tr.textContent.toLowerCase();tr.style.display=text.includes(filter)?"":"none";});}
    loadData();
  </script>
</body>
</html>
