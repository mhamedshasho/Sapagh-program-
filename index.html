&lt;!DOCTYPE html&gt;<br/>&lt;html lang=&quot;ar&quot; dir=&quot;rtl&quot;&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset=&quot;UTF-8&quot;&gt;<br/>  &lt;title&gt;دفتر الدفعات&lt;/title&gt;<br/>  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js&quot;&gt;&lt;/script&gt;<br/>  &lt;style&gt;<br/>    body {<br/>      font-family: &quot;Cairo&quot;, sans-serif;<br/>      background: linear-gradient(135deg, #0f172a, #1e293b);<br/>      color: #f1f5f9;<br/>      padding: 20px;<br/>      text-align: center;<br/>    }<br/>    h1 { margin-bottom: 10px; color: #38bdf8; }<br/>    img.logo { width: 100px; margin-bottom: 15px; }<br/>    .controls { margin: 15px 0; }<br/>    button {<br/>      margin: 5px;<br/>      padding: 10px 15px;<br/>      border: none;<br/>      background: #2563eb;<br/>      color: white;<br/>      border-radius: 8px;<br/>      cursor: pointer;<br/>      font-size: 14px;<br/>      transition: 0.2s;<br/>    }<br/>    button:hover { background: #1d4ed8; }<br/>    table {<br/>      width: 100%;<br/>      border-collapse: collapse;<br/>      background: #1e293b;<br/>      margin-top: 10px;<br/>      border-radius: 10px;<br/>      overflow: hidden;<br/>    }<br/>    th, td {<br/>      border: 1px solid #334155;<br/>      padding: 10px;<br/>      text-align: center;<br/>    }<br/>    th { background: #0f172a; color: #38bdf8; }<br/>    tr:nth-child(even) { background: #273449; }<br/>    td[contenteditable=&quot;true&quot;] { outline: none; }<br/>    footer {<br/>      margin-top: 20px;<br/>      font-size: 14px;<br/>      color: #94a3b8;<br/>    }<br/>    .highlight { color: #22c55e; font-weight: bold; }<br/>  &lt;/style&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;!-- الشعار --&gt;<br/>  &lt;img src=&quot;logo.png&quot; alt=&quot;شعار البرنامج&quot; class=&quot;logo&quot;&gt;<br/>  &lt;h1&gt;📘 دفتر الدفعات&lt;/h1&gt;<div></div>  &lt;!-- الأزرار --&gt;<br/>  &lt;div class=&quot;controls&quot;&gt;<br/>    &lt;button onclick=&quot;addRow()&quot;&gt;➕ إضافة صف&lt;/button&gt;<br/>    &lt;button onclick=&quot;deleteSelected()&quot;&gt;🗑️ حذف المحدد&lt;/button&gt;<br/>    &lt;button onclick=&quot;saveData()&quot;&gt;💾 حفظ&lt;/button&gt;<br/>    &lt;button onclick=&quot;clearAll()&quot;&gt;🧹 تفريغ&lt;/button&gt;<br/>    &lt;button onclick=&quot;saveAsImage()&quot;&gt;📷 حفظ كصورة&lt;/button&gt;<br/>  &lt;/div&gt;<div></div>  &lt;!-- الجدول --&gt;<br/>  &lt;table id=&quot;table&quot;&gt;<br/>    &lt;thead&gt;<br/>      &lt;tr&gt;<br/>        &lt;th&gt;&lt;input type=&quot;checkbox&quot; onclick=&quot;toggleAll(this)&quot;&gt;&lt;/th&gt;<br/>        &lt;th&gt;التاريخ&lt;/th&gt;<br/>        &lt;th&gt;المعهد / المدرسة&lt;/th&gt;<br/>        &lt;th&gt;الوصف&lt;/th&gt;<br/>        &lt;th&gt;النوع&lt;/th&gt;<br/>        &lt;th&gt;المبلغ&lt;/th&gt;<br/>        &lt;th&gt;الحالة&lt;/th&gt;<br/>        &lt;th&gt;ملاحظات&lt;/th&gt;<br/>      &lt;/tr&gt;<br/>    &lt;/thead&gt;<br/>    &lt;tbody id=&quot;tbody&quot;&gt;&lt;/tbody&gt;<br/>  &lt;/table&gt;<div></div>  &lt;p&gt;الإجمالي: &lt;span id=&quot;sum&quot; class=&quot;highlight&quot;&gt;0&lt;/span&gt;&lt;/p&gt;<br/>  &lt;p&gt;آخر حفظ: &lt;span id=&quot;lastSaved&quot;&gt;لم يتم بعد&lt;/span&gt;&lt;/p&gt;<div></div>  &lt;!-- التذييل --&gt;<br/>  &lt;footer&gt;<br/>    &lt;p&gt;تطوير: &lt;b&gt;محمد شاشو&lt;/b&gt;&lt;/p&gt;<br/>    &lt;p&gt;إهداء إلى أستاذي العزيز: &lt;b&gt;د. محمد صباغ&lt;/b&gt;&lt;/p&gt;<br/>  &lt;/footer&gt;<div></div>  &lt;script&gt;<br/>    const tbody = document.getElementById(&quot;tbody&quot;);<br/>    const sumEl = document.getElementById(&quot;sum&quot;);<br/>    const lastSavedEl = document.getElementById(&quot;lastSaved&quot;);<br/>    const STORAGE_KEY = &quot;payments_data&quot;;<div></div>    function addRow(data = {}) {<br/>      const tr = document.createElement(&quot;tr&quot;);<br/>      tr.innerHTML = `<br/>        &lt;td&gt;&lt;input type=&quot;checkbox&quot; class=&quot;row-check&quot;&gt;&lt;/td&gt;<br/>        &lt;td contenteditable=&quot;true&quot;&gt;${data.date || new Date().toISOString().slice(0,10)}&lt;/td&gt;<br/>        &lt;td contenteditable=&quot;true&quot;&gt;${data.school || &quot;&quot;}&lt;/td&gt;<br/>        &lt;td contenteditable=&quot;true&quot;&gt;${data.desc || &quot;&quot;}&lt;/td&gt;<br/>        &lt;td contenteditable=&quot;true&quot;&gt;${data.type || &quot;دخل&quot;}&lt;/td&gt;<br/>        &lt;td contenteditable=&quot;true&quot;&gt;${data.amount || 0}&lt;/td&gt;<br/>        &lt;td contenteditable=&quot;true&quot;&gt;${data.status || &quot;معلق&quot;}&lt;/td&gt;<br/>        &lt;td contenteditable=&quot;true&quot;&gt;${data.note || &quot;&quot;}&lt;/td&gt;<br/>      `;<br/>      tbody.appendChild(tr);<br/>      updateSum();<br/>    }<div></div>    function deleteSelected() {<br/>      document.querySelectorAll(&quot;.row-check:checked&quot;).forEach(ch =&gt; ch.closest(&quot;tr&quot;).remove());<br/>      updateSum();<br/>      saveData();<br/>    }<div></div>    function toggleAll(master) {<br/>      document.querySelectorAll(&quot;.row-check&quot;).forEach(ch =&gt; ch.checked = master.checked);<br/>    }<div></div>    function updateSum() {<br/>      let total = 0;<br/>      tbody.querySelectorAll(&quot;tr&quot;).forEach(tr =&gt; {<br/>        const amount = parseFloat(tr.cells[5].textContent) || 0;<br/>        const type = tr.cells[4].textContent.trim();<br/>        total += (type === &quot;مصروف&quot;) ? -amount : amount;<br/>      });<br/>      sumEl.textContent = total.toFixed(2);<br/>    }<div></div>    function saveData() {<br/>      const rows = [...tbody.querySelectorAll(&quot;tr&quot;)].map(tr =&gt; ({<br/>        date: tr.cells[1].textContent,<br/>        school: tr.cells[2].textContent,<br/>        desc: tr.cells[3].textContent,<br/>        type: tr.cells[4].textContent,<br/>        amount: tr.cells[5].textContent,<br/>        status: tr.cells[6].textContent,<br/>        note: tr.cells[7].textContent<br/>      }));<br/>      localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));<br/>      lastSavedEl.textContent = new Date().toLocaleString();<br/>    }<div></div>    function loadData() {<br/>      const raw = localStorage.getItem(STORAGE_KEY);<br/>      if (raw) {<br/>        JSON.parse(raw).forEach(r =&gt; addRow(r));<br/>      } else {<br/>        addRow();<br/>      }<br/>    }<div></div>    function clearAll() {<br/>      tbody.innerHTML = &quot;&quot;;<br/>      updateSum();<br/>      saveData();<br/>    }<div></div>    function saveAsImage() {<br/>      html2canvas(document.body).then(canvas =&gt; {<br/>        const link = document.createElement(&quot;a&quot;);<br/>        link.download = &quot;دفتر_الدفعات.png&quot;;<br/>        link.href = canvas.toDataURL();<br/>        link.click();<br/>      });<br/>    }<div></div>    loadData();<br/>  &lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;